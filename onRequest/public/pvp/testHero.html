<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试英雄</title>
    <style>
        .test{
            margin-left: 2%;
        }
        .dialog{
            position: fixed;
            left:0;
            top:0;
            display: none;
            width: 100%;
            height: 100%;
            background-color: darkgray;
        }
        .show{
            display: block;
        }
        .dialogContainer{
            margin: 5% 2% 2% 2%;
            /*width: 80%;*/
            height: 85%;
            overflow: scroll;
            background-color: white;
        }
        .dialogCloseBtn{
            float:right;
            margin-right: 5%;
        }
    </style>
    <script src="../js/library/jquery-3.3.1.min.js"></script>
    <script src="../js/util/file.js"></script>
</head>
<body style="font-size: 20px">
<!--<p>选项卡  /spider/getPvpTabs</p>-->
<!--<img src="/onRequest/public/images/pvp/tabs.jeg"/ >-->
<h3>header头务必设置x-requested-with（不区分大小写，推荐X-Requested-With），
    值为XMLHttpRequest（固定值，区分大小写），否则返回的数据不是json格式
</h3>
<p>
    获取 英雄单选框数据
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getHeroSearchRadios</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<img src="/onRequest/public/images/pvp/heroRadios.png?v=2" alt=""/>
<p>方式 GET , 无需参数</p>
<p>返回数据：json格式的字符串</p>
<pre>
[
    {
        "id": "1",
        "radio_text": "本周免费",
        "data_p_type": "10",
        "data_type": null
    },
    {
        "id": "2",
        "radio_text": "新手推荐",
        "data_p_type": "11",
        "data_type": null
    },
    {
        "id": "3",
        "radio_text": "全部",
        "data_p_type": null,
        "data_type": "0"
    },
</pre>
<hr/>
<p>英雄列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getHeroesList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
参数：<br/>
<ul>
    <li>complex  新手推荐（参数值必须是novice_recommendation） /  本周免费</li>
    <li>hero_type  值和解释如下
        <pre>
        'all'=> 0,//全部
        'tank'=> 3,//坦克
        'warrior'=>1,//战士
        'assassin'=> 4,//刺客
        'mage'=>2,//法师
        'shooter'=> 5,//射手
        'aid'=>6,//辅助
        </pre>
    </li>
</ul>
<p>返回数据：json格式的字符串</p>
<pre>
[
    {
        "id": "1",
        "ename": "105",
        "cname": "廉颇",
        "title": "正义爆轰",
        "new_type": "0",
        "hero_type": "3",
        "hero_type2": null,
        "pay_type": null,
        "skin_name": "正义爆轰|地狱岩魂",
        "detail_href": "https://pvp.qq.com/web201605/herodetail/105.shtml",
        "hero_avatar": "https://game.gtimg.cn/images/yxzj/img201606/heroimg/105/105.jpg"
    },
    {
        "id": "2",
        "ename": "106",
        "cname": "小乔",
        "title": "恋之微风",
        "new_type": "0",
        "hero_type": "2",
        "hero_type2": null,
        "pay_type": null,
        "skin_name": "恋之微风|万圣前夜|天鹅之梦|纯白花嫁|缤纷独角兽",
        "detail_href": "https://pvp.qq.com/web201605/herodetail/106.shtml",
        "hero_avatar": "https://game.gtimg.cn/images/yxzj/img201606/heroimg/106/106.jpg"
    },
</pre>
<hr/>
<p>局内道具单选搜索框
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getItemSearchRadios</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<img src="/onRequest/public/images/pvp/itemRadios_2.png" alt=""/>
<img src="/onRequest/public/images/pvp/itemRadios.png" alt=""/>
<p>返回结果：</p>
<pre>
    [
    {
        "id": "1",
        "radio_text": "常规模式",
        "data_type": "0",
        "children": [
            {
                "id": "3",
                "radio_text": "全部",
                "data_parent_type": "0",
                "data_type": "0"
            },
            {
                "id": "5",
                "radio_text": "攻击",
                "data_parent_type": "0",
                "data_type": "1"
            },
</pre>
<hr/>
<p>局内道具列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getItemList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<p>返回数据：</p>
<pre>
[
    {
        "id": "1",
        "des1": [
            "+20物理攻击"
        ],
        "item_id": "1111",
        "item_name": "铁剑",
        "item_type": "1",
        "price": "150",
        "total_price": "250",
        "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/1111.jpg"
    },
    {
        "id": "2",
        "des1": [
            "+10%攻击速度 "
        ],
        "item_id": "1112",
        "item_name": "匕首",
        "item_type": "1",
        "price": "174",
        "total_price": "290",
        "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/1112.jpg"
    },
</pre>
<hr/>
<p>召唤师列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getSummonerList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<pre>
[
    {
        "id": "1",
        "summoner_description": "30秒CD：对身边的野怪和小兵造成真实伤害并眩晕1秒",
        "summoner_id": "80104",
        "summoner_name": "惩击",
        "summoner_rank": "LV.1解锁",
        "summoner_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80104.jpg",
        "big_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80104-big.jpg"
    },
    {
        "id": "2",
        "summoner_description": "90秒CD：立即对身边敌军英雄造成其已损失生命值14%的真实伤害",
        "summoner_id": "80108",
        "summoner_name": "终结",
        "summoner_rank": "LV.3解锁",
        "summoner_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80108.jpg",
        "big_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80108-big.jpg"
    },
</pre>
<hr/>
<div id="user_mod">
    <table cellpadding="10" cellspacing="0" border="1">
        <caption>返回的数据</caption>
        <thead>
        <tr>
            <th>参数</th>
            <th>含义</th>
            <th>说明</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>errorCode</td>
            <td>错误码</td>
            <td>为0时，为欢喜的结局</td>
        </tr>
        <tr>
            <td>msg</td>
            <td>提示信息</td>
            <td></td>
        </tr>
        <tr>
            <td>data</td>
            <td>数据</td>
            <td>仅在errorCode=0时，才不为空</td>
        </tr>
        </tbody>
    </table>
    <p>注册--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>register</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        <tr>
            <td>密码</td>
            <td>必需</td>
            <td>password</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <p>用户名是否唯一--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>isUniqueUserName</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <p>登录--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>login</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        <tr>
            <td>密码</td>
            <td>必需</td>
            <td>password</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <label for="userName">用户名</label><input type="text" id="userName"/>
    <label for="password">密码</label><input type="text" id="password"/>
    <button type="button" onclick="obj.register(this)" data-url="">注册</button>
    <button type="button" onclick="obj.isUnique(this)" data-url="">用户名是否唯一</button>
    <button type="button" onclick="obj.login(this)" data-url="">登录</button>
    <hr/>

    <p>
        获取用户信息
        <span class="testUrl">
            /<span class="controller">user</span>/<span>getUserInfo</span>
        </span>
    </p>
    用户名:<span id="userInfo_userName"></span>
    <img src="" alt="">
    <button type="button" onclick="obj.getUserInfo(this)" data-url="">获取用户信息</button>
    <hr/>

    <p>上传头像
        <span class="testUrl">
            /<span class="controller">user</span>/<span>uploadAvatar</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>服务端返回的头像图片的名称</td>
            <td>必需</td>
            <td>avatar</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <form action="/user/uploadAvatar" method="post" enctype="multipart/form-data" style="display: inline-block">
        <label for="avatar">上传头像</label><input type="file" id="avatar" name="avatar"/>
        <input type="submit" value="提交表单">
    </form>
    <button type="button" onclick="obj.uploadAvatar(this)" data-url="">ajax上传头像</button>
    <hr/>

    <p>
        修改用户资料
        <span class="testUrl">
            /<span class="controller">user</span>/<span>modifyUserInfo</span>
        </span>
    </p>
    <label for="avatarImg">头像</label><input type="image" value="" id="avatarImg" alt="" src=""/>
    <button type="button" onclick="obj.modifyUserInfo(this)" data-url="">修改用户资料</button>
    <hr/>
</div>

<div id="dialog" class="dialog">
    <button type="button" class="dialogCloseBtn" onclick="obj.closeDialog()">关闭</button>
    <div id="ajaxError" class="dialogContainer">ajax错误</div>
</div>
<div id="ajaxSuccess"></div>
<script>
    class Test{
        init()
        {
            this.divObj = $("#ajaxError");
            this.userInfo = {};
            this.diaLogObj = $("#dialog");
        }
        triggerAjax(config)
        {
            let _this = this;
            //config.data = config.data ? {}: config.data;
            $.ajax({
                url : config.url,
                type: config.type,
                data: config.data,
                dataType : "json",
                before:function(xhr)
                {
                    _this.divObj.html('');
                },
                complete:function()
                {

                },
                success:function(result)
                {
                    if( typeof config.success === "function")
                    {
                        config.success(result);
                    }
                },
                error:function(xhr,status,error)
                {
                    _this.divObj.html(xhr.responseText);
                    _this.showDialog();
                }
            });
        }
        showDialog()
        {
            this.diaLogObj.attr('class','dialog show');
        }
        closeDialog()
        {
            this.diaLogObj.attr('class','dialog');
        }
        static getUserName()
        {
            return $("#userName").val();
        }
        static getPassword()
        {
            return $("#password").val();
        }
        register(me)
        {
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                    password:Test.getPassword(),
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        isUnique(me)
        {
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        login(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                    password:Test.getPassword(),
                },
                success:function (result) {
                    alert(result.msg);
                    _this.userInfo = result.data;
                }
            });
        }
        getUserInfo(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    id:  _this.userInfo.id,
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        uploadAvatar(me)
        {
            let _this = this;
            ajaxUploadFile({
                inputObj: document.getElementById("avatar"),
                inputName:'avatar',
                data :{
                    hello:'world'
                },
                url:me.getAttribute('data-url'),
                uploadingProgressFunc: function(percentComplete) {},
                handling:function(result){},
                success:function(apiData)
                {
                    console.log('success-apiData',apiData);
                    if( apiData.errorCode > 0)
                    {
                        alert(apiData.msg);
                        return;
                    }
                    let data = apiData.data;
                    if( data.successFiles )
                    {
                        let img = data.successFiles[0];
                        let obj = $("#avatarImg");
                        obj.attr('src', data.path + img);
                        obj.val(img);
                    }
                },
                error:function(response)
                {
                    _this.divObj.html(response);
                    _this.showDialog();
                },
            });
        }
        modifyUserInfo(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    avatar:$('#avatarImg').val(),
                },
                success:function (result) {
                    alert(result.msg);
                    _this.userInfo = result.data;
                }
            });
        }
    }
     let obj = new Test();
    obj.init();
    $(document).ready(function(){
        let arr = $("a.test");
        //console.log('a_arr=',a_arr);
        let href = '', ctrl ='', method = '';
        let spanObj = null;
        arr.each(function(index,currentItem){
            //console.log('currentItem=',currentItem);
            spanObj = $(currentItem).prev();
            ctrl  = spanObj.children().eq(0).text();
            method  = spanObj.children().eq(1).text();
            href = `/${ctrl}/${method}`;
            $(currentItem).attr("href",href)
        });
        //
        let userMod =  $("#user_mod");
        arr = userMod.find("span.testUrl");
        console.log('arr=',arr);
        arr.each(function(index,currentItem){
            spanObj = $(currentItem);
            ctrl  = spanObj.children().eq(0).text();
            method  = spanObj.children().eq(1).text();
            href = `/${ctrl}/${method}`;
            console.log("href=",href);
            spanObj.parent().siblings("button").eq(index).attr('data-url',href);
        });
    });
</script>
</body>
</html>
