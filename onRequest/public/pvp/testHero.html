<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试英雄</title>
    <style>
        .test{
            margin-left: 2%;
        }
        .dialog{
            position: fixed;
            left:0;
            top:0;
            display: none;
            width: 100%;
            height: 100%;
            background-color: darkgray;
        }
        .show{
            display: block;
        }
        .dialogContainer{
            margin: 5% 2% 2% 2%;
            /*width: 80%;*/
            height: 85%;
            overflow: scroll;
            background-color: white;
        }
        .dialogCloseBtn{
            float:right;
            margin-right: 5%;
        }
    </style>
    <script src="../js/library/jquery-3.3.1.min.js"></script>
    <script src="../js/util/file.js"></script>
</head>
<body style="font-size: 20px">
<!--<p>选项卡  /spider/getPvpTabs</p>-->
<!--<img src="/onRequest/public/images/pvp/tabs.jeg"/ >-->
<h3>header头务必设置x-requested-with（不区分大小写，推荐X-Requested-With），
    值为XMLHttpRequest（固定值，区分大小写），否则返回的数据不是json格式
</h3>
<p>
    获取 英雄单选框数据
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getHeroSearchRadios</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<img src="/onRequest/public/images/pvp/heroRadios.png?v=2" alt=""/>
<p>方式 GET , 无需参数</p>
<p>返回数据：json格式的字符串</p>
<pre>
[
    {
        "id": "1",
        "radio_text": "本周免费",
        "data_p_type": "10",
        "data_type": null
    },
    {
        "id": "2",
        "radio_text": "新手推荐",
        "data_p_type": "11",
        "data_type": null
    },
    {
        "id": "3",
        "radio_text": "全部",
        "data_p_type": null,
        "data_type": "0"
    },
</pre>
<hr/>
<p>英雄列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getHeroesList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<table cellpadding="10" cellspacing="0" border="1">
    <caption>参数</caption>
    <thead>
    <tr>
        <th>参数</th>
        <th>是否必需</th>
        <th>参数名</th>
        <th>类型</th>
        <th>解释</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>页码</td>
        <td>非必需</td>
        <td>p</td>
        <td>Integer</td>
        <td>需要第p页的列表数据</td>
    </tr>
    <tr>
        <td>每页条数</td>
        <td>非必需</td>
        <td>pageSize</td>
        <td>Integer</td>
        <td>每页显示pageSize条数据，默认10条</td>
    </tr>
    <tr>
        <td>英雄类型</td>
        <td>非必需</td>
        <td>hero_type</td>
        <td>int</td>
        <td>
            值和解释如下
            <pre>
        0,//全部
        3,//坦克
        1,//战士
        4,//刺客
        2,//法师
        5,//射手
        6,//辅助
        7,//新手推荐
        8,//本周免费
        </pre>
        </td>
    </tr>
    <tr>
        <td>英雄名称关键字</td>
        <td>非必须</td>
        <td>hero_name</td>
        <td>string</td>
        <td>优先级最高</td>
    </tr>
    </tbody>
</table>
<table cellpadding="10" cellspacing="0" border="1">
    <caption>返回的数据</caption>
    <thead>
    <tr>
        <th>参数</th>
        <th>含义</th>
        <th>说明</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>errorCode</td>
        <td>错误码</td>
        <td>为0时，为欢喜的结局</td>
    </tr>
    <tr>
        <td>msg</td>
        <td>提示信息</td>
        <td></td>
    </tr>
    <tr>
        <td>data</td>
        <td>数据</td>
        <td>仅在errorCode=0时，才不为空
            <table  cellpadding="10" cellspacing="0" border="1">
                <tr>
                    <td>list</td><td>列表数据</td>
                </tr>
                <tr>
                    <td>totalPage</td><td>总页数</td>
                </tr>
                <tr>
                    <td>totalRows</td><td>总共有totalRows条数据</td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
</table>

<br/>
<p>返回数据：json格式的字符串</p>
<pre>
{
    "errorCode": 0,
    "msg": "获取英雄列表数据成功",
    "data": {
        "list": [
            {
                "ename": "105",
                "cname": "廉颇",
                "title": "正义爆轰",
                "skin_name": "正义爆轰|地狱岩魂",
                "hero_avatar": "https://game.gtimg.cn/images/yxzj/img201606/heroimg/105/105.jpg"
            },
            {
                "ename": "106",
                "cname": "小乔",
                "title": "恋之微风",
                "skin_name": "恋之微风|万圣前夜|天鹅之梦|纯白花嫁|缤纷独角兽",
                "hero_avatar": "https://game.gtimg.cn/images/yxzj/img201606/heroimg/106/106.jpg"
            }
        ],
        "totalPage": 46,
        "totalRows": 91,
    }
}
</pre>
<hr/>
<p>局内道具单选搜索框
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getItemSearchRadios</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<img src="/onRequest/public/images/pvp/itemRadios_2.png" alt=""/>
<img src="/onRequest/public/images/pvp/itemRadios.png" alt=""/>
<p>返回结果：</p>
<pre>
    [
    {
        "id": "1",
        "radio_text": "常规模式",
        "data_type": "0",
        "children": [
            {
                "id": "3",
                "radio_text": "全部",
                "data_parent_type": "0",
                "data_type": "0"
            },
            {
                "id": "5",
                "radio_text": "攻击",
                "data_parent_type": "0",
                "data_type": "1"
            },
</pre>
<hr/>
<p>局内道具列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getItemList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<table cellpadding="10" cellspacing="0" border="1">
    <caption>参数</caption>
    <thead>
    <tr>
        <th>参数</th>
        <th>是否必需</th>
        <th>参数名</th>
        <th>类型</th>
        <th>解释</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>页码</td>
        <td>非必需</td>
        <td>p</td>
        <td>Integer</td>
        <td>需要第p页的列表数据</td>
    </tr>
    <tr>
        <td>每页条数</td>
        <td>非必需</td>
        <td>pageSize</td>
        <td>Integer</td>
        <td>每页显示pageSize条数据，默认10条</td>
    </tr>
    <tr>
        <td>常规模式? 边境突围模式?</td>
        <td>非必需</td>
        <td>parent_type</td>
        <td>int</td>
        <td>
            <p>【常规模式】的话，参数值必须是0</p>
            <p>【边境突围模式】的话，参数值推荐为1；</p>
        </td>
    </tr>
    <tr>
        <td>子类型</td>
        <td>非必需</td>
        <td>type</td>
        <td>int</td>
        <td>
            值和解释如下
            <table cellpadding="10" cellspacing="0" border="1">
                <tr>
                    <th>常规模式</th>
                    <td> 0全部</td>
                    <td> 1攻击</td>
                    <td>2法术</td>
                    <td>3防御</td>
                    <td>4移动</td>
                    <td>5打野</td>
                    <td>7辅助</td>
                </tr>
                <tr style="background-color:skyblue">
                    <th>边境突围模式</th>
                    <td>0全部</td>
                    <td>1装备</td>
                    <td>2道具</td>
                    <td>3额外技能</td>
                </tr>
            </table>
            <pre>

        </pre>
        </td>
    </tr>
    </tbody>
</table>
<table cellpadding="10" cellspacing="0" border="1">
    <caption>返回的数据</caption>
    <thead>
    <tr>
        <th>参数</th>
        <th>含义</th>
        <th>说明</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>errorCode</td>
        <td>错误码</td>
        <td>为0时，为欢喜的结局</td>
    </tr>
    <tr>
        <td>msg</td>
        <td>提示信息</td>
        <td></td>
    </tr>
    <tr>
        <td>data</td>
        <td>数据</td>
        <td>仅在errorCode=0时，才不为空
            <table  cellpadding="10" cellspacing="0" border="1">
                <tr>
                    <td>list</td><td>列表数据</td>
                </tr>
                <tr>
                    <td>totalPage</td><td>总页数</td>
                </tr>
                <tr>
                    <td>totalRows</td><td>总共有totalRows条数据</td>
                </tr>
            </table>
        </td>
    </tr>
    </tbody>
</table>
<p>返回数据：</p>
<table cellpadding="0" cellspacing="0" border="1">
    <tr>
        <th>常规模式</th>
        <th>边境突围模式</th>
    </tr>
    <tr>
        <td>
            <pre>
{
    "errorCode": 0,
    "msg": "获取列表数据成功",
    "data": {
        "list": [
            {
                "des1": [
                    "+20物理攻击"
                ],
                "item_id": "1111",
                "item_name": "铁剑",
                "item_type": "1",
                "price": "150",
                "total_price": "250",
                "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/1111.jpg"
            },
            {
                "des1": [
                    "+10%攻击速度 "
                ],
                "item_id": "1112",
                "item_name": "匕首",
                "item_type": "1",
                "price": "174",
                "total_price": "290",
                "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/1112.jpg"
            }
        ],
        "totalPage": 48,
        "totalRows": 95,
    }
}
</pre>
        </td>
        <td>
            <pre>
                {
    "errorCode": 0,
    "msg": "获取列表数据成功",
    "data": {
        "list": [
            {
                "des1": [
                    "+250攻击"
                ],
                "des2": "唯一被动:【破军】:目标生命低于50%时伤害提高30%",
                "item_id": "2000",
                "item_level": "4级",
                "item_name": "砂之破军",
                "item_type": "1",
                "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/2000.jpg"
            },
            {
                "des1": [
                    "+400法攻",
                    "+600最大生命"
                ],
                "des2": "唯一被动:【刻印】：增加1400点最大生命值",
                "item_id": "2001",
                "item_level": "4级",
                "item_name": "贤者之书",
                "item_type": "1",
                "item_img": "https://game.gtimg.cn/images/yxzj/img201606/itemimg/2001.jpg"
            }
        ],
        "totalPage": 6,
        "totalRows": 11,
    }
}
            </pre>
        </td>
    </tr>
</table>
<hr/>
<p>召唤师列表
    <span class="testUrl">
        /<span class="controller">pvp</span>/<span>getSummonerList</span>
    </span>
    <a href="" target="_blank" class="test">测试</a>
</p>
<pre>
[
    {
        "id": "1",
        "summoner_description": "30秒CD：对身边的野怪和小兵造成真实伤害并眩晕1秒",
        "summoner_id": "80104",
        "summoner_name": "惩击",
        "summoner_rank": "LV.1解锁",
        "summoner_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80104.jpg",
        "big_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80104-big.jpg"
    },
    {
        "id": "2",
        "summoner_description": "90秒CD：立即对身边敌军英雄造成其已损失生命值14%的真实伤害",
        "summoner_id": "80108",
        "summoner_name": "终结",
        "summoner_rank": "LV.3解锁",
        "summoner_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80108.jpg",
        "big_img": "https://game.gtimg.cn/images/yxzj/img201606/summoner/80108-big.jpg"
    },
</pre>
<hr/>
<div id="user_mod">
    <table cellpadding="10" cellspacing="0" border="1">
        <caption>返回的数据</caption>
        <thead>
        <tr>
            <th>参数</th>
            <th>含义</th>
            <th>说明</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>errorCode</td>
            <td>错误码</td>
            <td>为0时，为欢喜的结局</td>
        </tr>
        <tr>
            <td>msg</td>
            <td>提示信息</td>
            <td></td>
        </tr>
        <tr>
            <td>data</td>
            <td>数据</td>
            <td>仅在errorCode=0时，才不为空</td>
        </tr>
        <tr>
            <td>session_id</td>
            <td>会话凭证</td>
            <td>只有登录接口提供此项，登录成功时提供</td>
        </tr>
        </tbody>
    </table>
    <p>注册--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>register</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        <tr>
            <td>密码</td>
            <td>必需</td>
            <td>password</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <p>用户名是否唯一--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>isUniqueUserName</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <p>登录--POST--
        <span class="testUrl">
            /<span class="controller">user</span>/<span>login</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>用户名</td>
            <td>必需</td>
            <td>userName</td>
            <td>String</td>
        </tr>
        <tr>
            <td>密码</td>
            <td>必需</td>
            <td>password</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <label for="userName">用户名</label><input type="text" id="userName"/>
    <label for="password">密码</label><input type="text" id="password"/>
    <button type="button" onclick="obj.register(this)" data-url="">注册</button>
    <button type="button" onclick="obj.isUnique(this)" data-url="">用户名是否唯一</button>
    <button type="button" onclick="obj.login(this)" data-url="">登录</button>
    <hr/>

    <p>
        获取用户信息
        <span class="testUrl">
            /<span class="controller">user</span>/<span>getUserInfo</span>
        </span>
    </p>
    用户名:<span id="userInfo_userName"></span>
    <img src="" alt="">
    <button type="button" onclick="obj.getUserInfo(this)" data-url="">获取用户信息</button>
    <hr/>

    <p>上传头像
        <span class="testUrl">
            /<span class="controller">user</span>/<span>uploadAvatar</span>
        </span>
    </p>
    <table cellpadding="10" cellspacing="0" border="1">
        <thead>
        <tr>
            <th>参数</th>
            <th>是否必需</th>
            <th>参数名</th>
            <th>类型</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>服务端返回的头像图片的名称</td>
            <td>必需</td>
            <td>avatar</td>
            <td>String</td>
        </tr>
        </tbody>
    </table>
    <form action="/user/uploadAvatar" method="post" enctype="multipart/form-data" style="display: inline-block">
        <label for="avatar">上传头像</label><input type="file" id="avatar" name="avatar"/>
        <input type="submit" value="提交表单">
    </form>
    <button type="button" onclick="obj.uploadAvatar(this)" data-url="">ajax上传头像</button>
    <hr/>

    <p>
        修改用户资料
        <span class="testUrl">
            /<span class="controller">user</span>/<span>modifyUserInfo</span>
        </span>
    </p>
    <label for="avatarImg">头像</label><input type="image" value="" id="avatarImg" alt="" src=""/>
    <label for="age">年纪</label><input type="number" id="age"  value="28"/>
    <label for="sex">性别</label><input type="text"  id="sex" value="男" />
    <button type="button" onclick="obj.modifyUserInfo(this)" data-url="">修改用户资料</button>
    <hr/>
</div>
<div>
    以下接口全部需要传参数 eName（类型：int）--GET
    <p>获取详情  /Hero/getDetail</p>
    <p>获取皮肤  /Hero/getSkins</p>
    <p>获取技能  /Hero/getSkills</p>
    <p>获取铭文搭配  /Hero/getInscriptionMatch</p>
    <p>获取技能加点  /Hero/getSkillsPlusSuggestions</p>
    <p>获取出装建议  /Hero/getOutfitSuggestion</p>
    <p>获取英雄关系  /Hero/getRelations</p>
    <p>获取视频  /Hero/getVideos</p>
</div>

<div id="dialog" class="dialog">
    <button type="button" class="dialogCloseBtn" onclick="obj.closeDialog()">关闭</button>
    <div id="ajaxError" class="dialogContainer">ajax错误</div>
</div>
<div id="ajaxSuccess"></div>
<script>
    class Test{
        init()
        {
            this.divObj = $("#ajaxError");
            this.userInfo = {};
            this.diaLogObj = $("#dialog");
        }
        triggerAjax(config)
        {
            let _this = this;
            //config.data = config.data ? {}: config.data;
            $.ajax({
                url : config.url,
                type: config.type,
                data: config.data,
                dataType : "json",
                before:function(xhr)
                {
                    _this.divObj.html('');
                },
                complete:function()
                {

                },
                success:function(result)
                {
                    if( typeof config.success === "function")
                    {
                        config.success(result);
                    }
                },
                error:function(xhr,status,error)
                {
                    _this.divObj.html(xhr.responseText);
                    _this.showDialog();
                }
            });
        }
        showDialog()
        {
            this.diaLogObj.attr('class','dialog show');
        }
        closeDialog()
        {
            this.diaLogObj.attr('class','dialog');
        }
        static getUserName()
        {
            return $("#userName").val();
        }
        static getPassword()
        {
            return $("#password").val();
        }
        register(me)
        {
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                    password:Test.getPassword(),
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        isUnique(me)
        {
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        login(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    userName:Test.getUserName(),
                    password:Test.getPassword(),
                },
                success:function (result) {
                    alert(result.msg);
                    _this.userInfo = result.data;
                }
            });
        }
        getUserInfo(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    id:  _this.userInfo.id,
                },
                success:function (result) {
                    alert(result.msg);
                }
            });
        }
        uploadAvatar(me)
        {
            let _this = this;
            ajaxUploadFile({
                inputObj: document.getElementById("avatar"),
                inputName:'avatar',
                data :{
                    hello:'world'
                },
                url:me.getAttribute('data-url'),
                uploadingProgressFunc: function(percentComplete) {},
                handling:function(result){},
                success:function(apiData)
                {
                    console.log('success-apiData',apiData);
                    if( apiData.errorCode > 0)
                    {
                        alert(apiData.msg);
                        return;
                    }
                    let data = apiData.data;
                    if( data.successFiles )
                    {
                        let img = data.successFiles[0];
                        let obj = $("#avatarImg");
                        obj.attr('src', data.path + img);
                        obj.val(img);
                    }
                },
                error:function(response)
                {
                    _this.divObj.html(response);
                    _this.showDialog();
                },
            });
        }
        modifyUserInfo(me)
        {
            let _this = this;
            this.triggerAjax({
                url :me.getAttribute('data-url'),
                type: 'POST',
                data :{
                    avatar:$('#avatarImg').val(),
                    age:$('#age').val(),
                    sex:$('#sex').val(),
                },
                success:function (result) {
                    alert(result.msg);
                    _this.userInfo = result.data;
                }
            });
        }
    }
     let obj = new Test();
    obj.init();
    $(document).ready(function(){
        let arr = $("a.test");
        //console.log('a_arr=',a_arr);
        let href = '', ctrl ='', method = '';
        let spanObj = null;
        arr.each(function(index,currentItem){
            //console.log('currentItem=',currentItem);
            spanObj = $(currentItem).prev();
            ctrl  = spanObj.children().eq(0).text();
            method  = spanObj.children().eq(1).text();
            href = `/${ctrl}/${method}`;
            $(currentItem).attr("href",href)
        });
        //
        let userMod =  $("#user_mod");
        arr = userMod.find("span.testUrl");
        console.log('arr=',arr);
        arr.each(function(index,currentItem){
            spanObj = $(currentItem);
            ctrl  = spanObj.children().eq(0).text();
            method  = spanObj.children().eq(1).text();
            href = `/${ctrl}/${method}`;
            console.log("href=",href);
            spanObj.parent().siblings("button").eq(index).attr('data-url',href);
        });
    });
</script>
</body>
</html>
